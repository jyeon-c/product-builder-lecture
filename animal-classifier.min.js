const URL="https://teachablemachine.withgoogle.com/models/xQ-P0uqTP/";let model,maxPredictions;const fileUpload=document.getElementById("file-upload");const fileUploadButton=document.getElementById("file-upload-button");const imagePreview=document.getElementById("image-preview");const placeholder=document.getElementById("placeholder-container");const resultContainer=document.getElementById("result-container");const resultTitle=document.getElementById("result-title");const loader=document.querySelector(".loader");function showLoader(show){loader.style.display=show?"block":"none"}document.addEventListener("DOMContentLoaded",()=>{fileUploadButton.addEventListener("click",()=>fileUpload.click());fileUpload.addEventListener("change",handleFileSelect)});async function loadModel(){if(model)return;showLoader(true);try{const modelURL=URL+"model.json";const metadataURL=URL+"metadata.json";model=await tmImage.load(modelURL,metadataURL);maxPredictions=model.getTotalClasses()}catch(error){console.error("모델 로딩 실패:",error);resultTitle.textContent="모델을 로드하는 데 실패했습니다. 페이지를 새로고침 해주세요.";resultContainer.classList.add("active")}finally{showLoader(false)}}async function handleFileSelect(event){const file=event.target.files&&event.target.files[0];if(!file)return;await resetState();showLoader(true);placeholder.style.display="none";const reader=new FileReader;reader.onload=async e=>{imagePreview.src=e.target.result;imagePreview.style.display="block";imagePreview.onload=async()=>{try{await loadModel();await predict(imagePreview)}catch(error){console.error("파일 예측 오류:",error)}finally{showLoader(false)}}};reader.readAsDataURL(file)}async function predict(imageElement){if(!model){console.error("모델이 준비되지 않았습니다.");return}const prediction=await model.predict(imageElement,false);updateResultUI(prediction)}function updateResultUI(prediction){const dogPrediction=prediction.find(p=>p.className.toLowerCase()==="dog");const catPrediction=prediction.find(p=>p.className.toLowerCase()==="cat");if(!dogPrediction||!catPrediction){console.error("예측 클래스 'Dog' 또는 'Cat'를 찾을 수 없습니다. 받은 클래스:",prediction.map(p=>p.className));resultTitle.textContent="결과를 처리하는 중 오류가 발생했습니다.";resultContainer.classList.add("active");return}const dogProb=dogPrediction.probability;const catProb=catPrediction.probability;const dogPercent=(dogProb*100).toFixed(1);const catPercent=(catProb*100).toFixed(1);document.getElementById("dog-result").style.width=dogPercent+"%";document.getElementById("cat-result").style.width=catPercent+"%";document.getElementById("dog-percent").textContent=dogPercent+"%";document.getElementById("cat-percent").textContent=catPercent+"%";resultTitle.textContent=dogProb>catProb?"분석 결과: 당신은 강아지상에 가깝습니다!":catProb>dogProb?"분석 결과: 당신은 고양이상에 가깝습니다!":"분석 결과: 강아지상과 고양이상의 특징이 모두 있네요!";resultContainer.classList.add("active")}async function resetState(){imagePreview.style.display="none";imagePreview.src="#";imagePreview.onload=null;placeholder.style.display="flex";resultContainer.classList.remove("active");fileUpload.value=""}